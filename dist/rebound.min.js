/**
 *  Copyright (c) 2013, Facebook, Inc.
 *  All rights reserved.
 *
 *  This source code is licensed under the BSD-style license found in the
 *  LICENSE file in the root directory of this source tree. An additional grant
 *  of patent rights can be found in the PATENTS file in the same directory.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.rebound=e()}(this,function(){"use strict";var t=void 0;"undefined"!=typeof window&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame),t||"undefined"==typeof process||"node"!==process.title||(t=setImmediate);var e=t=t||function(t){window.setTimeout(t,1e3/60)},i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t};function o(t){return e(t)}var s=Date.now(),u="object"===("undefined"==typeof performance?"undefined":i(performance))&&"function"==typeof performance.now?function(){return performance.now()}:function(){return Date.now()-s};function a(t,e){var i=t.indexOf(e);-1!==i&&t.splice(i,1)}var p={};function h(t){if(p[t])return p[t];var e=t.replace("#","");3===e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);var i=e.match(/.{2}/g);if(!i||i.length<3)throw new Error("Expected a color string of format #rrggbb");var n={r:parseInt(i[0],16),g:parseInt(i[1],16),b:parseInt(i[2],16)};return p[t]=n,n}function c(t,e,i){var n=t.toString(16),r=e.toString(16),o=i.toString(16);return"#"+(n=n.length<2?"0"+n:n)+(r=r.length<2?"0"+r:r)+(o=o.length<2?"0"+o:o)}var l=Object.freeze({extend:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},onFrame:o,performanceNow:u,removeFirst:a,hexToRGB:h,rgbToHex:c});function f(t,e,i,n,r){return n+(t-e)/(i-e)*(r-n)}var g=Math.PI/180,d=180/Math.PI;var _=Object.freeze({mapValueInRange:f,interpolateColor:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments[5],s=h(e),u=h(i),a=0|f(t,n,r,s.r,u.r),p=0|f(t,n,r,s.g,u.g),l=0|f(t,n,r,s.b,u.b);return o?"rgb("+a+","+p+","+l+")":c(a,p,l)},degreesToRadians:function(t){return t*g},radiansToDegrees:function(t){return t*d}});function m(t){return 3.62*t+85.39999999999999}function y(t){return 3*t+1}var S=Object.freeze({tensionFromOrigamiValue:m,origamiValueFromTension:function(t){return t/3.62-23.591160220994475},frictionFromOrigamiValue:y,origamiFromFriction:function(t){return t/3-.333333333333334}}),v=function(){function t(){n(this,t),this.springSystem=null}return t.prototype.run=function(){var t=I.call(this);o(function(){t.loop(u())})},t}(),b=function(){function t(e){n(this,t),this.springSystem=null,this.time=0,this.running=!1,this.timestep=e||16.667}return t.prototype.run=function(){var t=I.call(this);if(!this.running){for(this.running=!0;!t.getIsIdle();)t.loop(this.time+=this.timestep);this.running=!1}},t}(),A=function(){function t(){n(this,t),this.springSystem=null,this.time=0,this.running=!1}return t.prototype.run=function(){},t.prototype.step=function(t){I.call(this).loop(this.time+=t)},t}();
/**
 *  Copyright (c) 2013, Facebook, Inc.
 *  All rights reserved.
 *
 *  This source code is licensed under the BSD-style license found in the
 *  LICENSE file in the root directory of this source tree. An additional grant
 *  of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 */function I(){if(null==this.springSystem)throw new Error("cannot run looper without a springSystem");return this.springSystem}var w=Object.freeze({AnimationLooper:v,SimulationLooper:b,SteppingSimulationLooper:A}),R=function(){function t(e,i){n(this,t),this.bounciness=e,this.speed=i;var r=this.normalize(e/1.7,0,20);r=this.projectNormal(r,0,.8);var o=this.normalize(i/1.7,0,20);this.bouncyTension=this.projectNormal(o,.5,200),this.bouncyFriction=this.quadraticOutInterpolation(r,this.b3Nobounce(this.bouncyTension),.01)}return t.prototype.normalize=function(t,e,i){return(t-e)/(i-e)},t.prototype.projectNormal=function(t,e,i){return e+t*(i-e)},t.prototype.linearInterpolation=function(t,e,i){return t*i+(1-t)*e},t.prototype.quadraticOutInterpolation=function(t,e,i){return this.linearInterpolation(2*t-t*t,e,i)},t.prototype.b3Friction1=function(t){return 7e-4*Math.pow(t,3)-.031*Math.pow(t,2)+.64*t+1.28},t.prototype.b3Friction2=function(t){return 44e-6*Math.pow(t,3)-.006*Math.pow(t,2)+.36*t+2},t.prototype.b3Friction3=function(t){return 4.5e-7*Math.pow(t,3)-332e-6*Math.pow(t,2)+.1078*t+5.84},t.prototype.b3Nobounce=function(t){return t<=18?this.b3Friction1(t):t>18&&t<=44?this.b3Friction2(t):this.b3Friction3(t)},t}(),T=function(){function t(e,i){n(this,t),this.tension=e,this.friction=i}return t.fromOrigamiTensionAndFriction=function(e,i){return new t(m(e),y(i))},t.fromBouncinessAndSpeed=function(e,i){var n=new R(e,i);return t.fromOrigamiTensionAndFriction(n.bouncyTension,n.bouncyFriction)},t.coastingConfigWithOrigamiFriction=function(e){return new t(0,y(e))},t}();T.DEFAULT_ORIGAMI_SPRING_CONFIG=T.fromOrigamiTensionAndFriction(40,7);var E=function t(){n(this,t),this.position=0,this.velocity=0};var V=function(t){var e,i=t.Symbol;return"function"==typeof i?i.observable?e=i.observable:(e=i("observable"),i.observable=e):e="@@observable",e}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()),C=function(){function t(e){var i=this;n(this,t),this.listeners=[],this._startValue=0,this._currentState=new E,this._displacementFromRestThreshold=.001,this._endValue=0,this._overshootClampingEnabled=!1,this._previousState=new E,this._restSpeedThreshold=.001,this._tempState=new E,this._timeAccumulator=0,this._wasAtRest=!0,this[V]=function(){var t;return(t={subscribe:function(t){function e(e){t.next(e.getCurrentValue())}var n={onSpringActivate:e,onSpringUpdate:e,onSpringAtRest:e};return i.addListener(n),function(){return i.removeListener(n)}}})[V]=function(){return this},t},this._id="s"+t._ID++,this._springSystem=e}return t.prototype.destroy=function(){this.listeners=[],this._springSystem.deregisterSpring(this)},t.prototype.getId=function(){return this._id},t.prototype.setSpringConfig=function(t){return this._springConfig=t,this},t.prototype.getSpringConfig=function(){return this._springConfig},t.prototype.setCurrentValue=function(t,e){return this._startValue=t,this._currentState.position=t,e||this.setAtRest(),this.notifyPositionUpdated(!1,!1),this},t.prototype.getStartValue=function(){return this._startValue},t.prototype.getCurrentValue=function(){return this._currentState.position},t.prototype.getCurrentDisplacementDistance=function(){return this.getDisplacementDistanceForState(this._currentState)},t.prototype.getDisplacementDistanceForState=function(t){return Math.abs(this._endValue-t.position)},t.prototype.setEndValue=function(t){if(this._endValue===t&&this.isAtRest())return this;this._startValue=this.getCurrentValue(),this._endValue=t,this._springSystem.activateSpring(this.getId());for(var e=0,i=this.listeners.length;e<i;e+=1){var n=this.listeners[e].onSpringEndStateChange;n&&n(this)}return this},t.prototype.getEndValue=function(){return this._endValue},t.prototype.setVelocity=function(t){return t===this._currentState.velocity?this:(this._currentState.velocity=t,this._springSystem.activateSpring(this.getId()),this)},t.prototype.getVelocity=function(){return this._currentState.velocity},t.prototype.setRestSpeedThreshold=function(t){return this._restSpeedThreshold=t,this},t.prototype.getRestSpeedThreshold=function(){return this._restSpeedThreshold},t.prototype.setRestDisplacementThreshold=function(t){this._displacementFromRestThreshold=t},t.prototype.getRestDisplacementThreshold=function(){return this._displacementFromRestThreshold},t.prototype.setOvershootClampingEnabled=function(t){return this._overshootClampingEnabled=t,this},t.prototype.isOvershootClampingEnabled=function(){return this._overshootClampingEnabled},t.prototype.isOvershooting=function(){if(this._springConfig.tension>>31)return!1;var t=this._startValue,e=this._endValue;if(t===e)return!1;var i=this.getCurrentValue();return i!==e&&t<e==i>e},t.prototype.advance=function(e,i){var n=this.isAtRest();if(!n||!this._wasAtRest){var r=i;i>t.MAX_DELTA_TIME_SEC&&(r=t.MAX_DELTA_TIME_SEC),this._timeAccumulator+=r;for(var o=this._springConfig.tension,s=this._springConfig.friction,u=t.SOLVER_TIMESTEP_SEC,a=t.SOLVER_TIMESTEP_SEC_BY_2,p=this._currentState.position,h=this._currentState.velocity,c=this._tempState.position,l=this._tempState.velocity,f=void 0,g=void 0,d=void 0,_=void 0,m=void 0,y=void 0,S=void 0,v=void 0;this._timeAccumulator>=u;)this._timeAccumulator-=u,this._timeAccumulator<u&&(this._previousState.position=p,this._previousState.velocity=h),f=h,g=o*(this._endValue-c)-s*h,c=p+f*a,d=l=h+g*a,_=o*(this._endValue-c)-s*l,c=p+d*a,m=l=h+_*a,y=o*(this._endValue-c)-s*l,c=p+m*u,S=l=h+y*u,v=o*(this._endValue-c)-s*l,p+=1/6*(f+2*(d+m)+S)*u,h+=1/6*(g+2*(_+y)+v)*u;this._tempState.position=c,this._tempState.velocity=l,this._currentState.position=p,this._currentState.velocity=h,this._timeAccumulator>0&&this._interpolate(this._timeAccumulator/t.SOLVER_TIMESTEP_SEC),(this.isAtRest()||this._overshootClampingEnabled&&this.isOvershooting())&&(this._springConfig.tension>0?(this._startValue=this._endValue,this._currentState.position=this._endValue):(this._endValue=this._currentState.position,this._startValue=this._endValue),this.setVelocity(0),n=!0);var b=!1;this._wasAtRest&&(this._wasAtRest=!1,b=!0);var A=!1;n&&(this._wasAtRest=!0,A=!0),this.notifyPositionUpdated(b,A)}},t.prototype.notifyPositionUpdated=function(t,e){for(var i=0,n=this.listeners.length;i<n;i+=1){var r=this.listeners[i];t&&r.onSpringActivate&&r.onSpringActivate(this),r.onSpringUpdate&&r.onSpringUpdate(this),e&&r.onSpringAtRest&&r.onSpringAtRest(this)}},t.prototype.systemShouldAdvance=function(){return!this.isAtRest()||!this.wasAtRest()},t.prototype.wasAtRest=function(){return this._wasAtRest},t.prototype.isAtRest=function(){return Math.abs(this._currentState.velocity)<this._restSpeedThreshold&&(this.getDisplacementDistanceForState(this._currentState)<=this._displacementFromRestThreshold||0===this._springConfig.tension)},t.prototype.setAtRest=function(){return this._endValue=this._currentState.position,this._tempState.position=this._currentState.position,this._currentState.velocity=0,this},t.prototype._interpolate=function(t){this._currentState.position=this._currentState.position*t+this._previousState.position*(1-t),this._currentState.velocity=this._currentState.velocity*t+this._previousState.velocity*(1-t)},t.prototype.getListeners=function(){return this.listeners},t.prototype.addListener=function(t){return this.listeners.push(t),this},t.prototype.removeListener=function(t){return a(this.listeners,t),this},t.prototype.removeAllListeners=function(){return this.listeners=[],this},t.prototype.currentValueIsApproximately=function(t){return Math.abs(this.getCurrentValue()-t)<=this.getRestDisplacementThreshold()},t}();C._ID=0,C.MAX_DELTA_TIME_SEC=.064,C.SOLVER_TIMESTEP_SEC=.001,C.SOLVER_TIMESTEP_SEC_BY_2=5e-4;var F=function(){function t(e){n(this,t),this.listeners=[],this._activeSprings=[],this._idleSpringIndices=[],this._isIdle=!0,this._lastTimeMillis=-1,this._springRegistry={},this.looper=e||new v,this.looper.springSystem=this}return t.prototype.setLooper=function(t){this.looper=t,t.springSystem=this},t.prototype.createSpring=function(t,e){var i=void 0;return i=void 0===t||void 0===e?T.DEFAULT_ORIGAMI_SPRING_CONFIG:T.fromOrigamiTensionAndFriction(t,e),this.createSpringWithConfig(i)},t.prototype.createSpringWithBouncinessAndSpeed=function(t,e){var i=void 0;return i=void 0===t||void 0===e?T.DEFAULT_ORIGAMI_SPRING_CONFIG:T.fromBouncinessAndSpeed(t,e),this.createSpringWithConfig(i)},t.prototype.createSpringWithConfig=function(t){var e=new C(this);return this.registerSpring(e),e.setSpringConfig(t),e},t.prototype.getIsIdle=function(){return this._isIdle},t.prototype.getSpringById=function(t){return this._springRegistry[t]},t.prototype.getAllSprings=function(){var t=[],e=0;for(var i in this._springRegistry)this._springRegistry.hasOwnProperty(i)&&(t[e++]=this._springRegistry[i]);return t},t.prototype.registerSpring=function(t){this._springRegistry[t.getId()]=t},t.prototype.deregisterSpring=function(t){a(this._activeSprings,t),delete this._springRegistry[t.getId()]},t.prototype.advance=function(t,e){var i=0;this._idleSpringIndices.length=i,t/=1e3,e/=1e3;for(var n=0,r=this._activeSprings.length;n<r;n+=1){var o=this._activeSprings[n];o.systemShouldAdvance()?o.advance(t,e):this._idleSpringIndices[i++]=this._activeSprings.indexOf(o)}for(;i;){var s=this._idleSpringIndices[--i];this._idleSpringIndices.length=i,s>=0&&this._activeSprings.splice(s,1)}},t.prototype.loop=function(t){var e=void 0;-1===this._lastTimeMillis&&(this._lastTimeMillis=t-1);var i=t-this._lastTimeMillis;this._lastTimeMillis=t;for(var n=0,r=this.listeners.length;n<r;)e=this.listeners[n],n+=1,e.onBeforeIntegrate&&e.onBeforeIntegrate(this);for(this.advance(t,i),0===this._activeSprings.length&&(this._isIdle=!0,this._lastTimeMillis=-1),n=0;n<r;)e=this.listeners[n],n+=1,e.onAfterIntegrate&&e.onAfterIntegrate(this);this._isIdle||this.looper.run()},t.prototype.activateSpring=function(t){var e=this._springRegistry[t],i=this._activeSprings;-1===i.indexOf(e)&&(i[i.length]=e),this.getIsIdle()&&(this._isIdle=!1,this.looper.run())},t.prototype.addListener=function(t){this.listeners.push(t)},t.prototype.removeListener=function(t){a(this.listeners,t)},t.prototype.removeAllListeners=function(){this.listeners=[]},t}();return r({},w,{OrigamiValueConverter:S,MathUtil:_,Spring:C,SpringConfig:T,SpringSystem:F,util:r({},l,_)})});
